<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECOSONAR - Análisis Acústico Marino</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="icon" href="./storage/logo.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

    <meta name="color-scheme" content="light dark" />
</head>

<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="nav-brand">
                <img src="./storage/icono.png" style="width: 80px;"></i>
                <span>ECOSONAR</span>
            </div>
            <ul class="nav-menu">
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="#analisis">Análisis</a></li>
                <li><a href="#monitoreo">Monitoreo</a></li>
                <li><a href="#configuracion">Configuración</a></li>
                <li><a href="#beneficios">Beneficios</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="Abrir menú">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="inicio" class="hero-section">
            <div class="hero-container">
                <div class="hero-content animate-fade-in-up">
                    <h1 class="hero-title">
                        Análisis Acústico Marino
                        <span class="gradient-text">Inteligente</span>
                    </h1>
                    <p class="hero-description">
                        Revoluciona el monitoreo marino con tecnología de vanguardia.
                        ECOSONAR utiliza inteligencia artificial para analizar patrones acústicos
                        y proteger los ecosistemas marinos.
                    </p>
                    <div class="hero-buttons">
                        <button class="btn-primary" onclick="scrollToSection('analisis')">
                            <i class="fas fa-play"></i>
                            Comenzar Análisis
                        </button>
                        <button class="btn-secondary" onclick="scrollToSection('monitoreo')">
                            <i class="fas fa-chart-line"></i>
                            Ver Monitoreo
                        </button>
                    </div>
                </div>
                <div class="hero-visual animate-float">
                    <div class="sonar-circle"></div>
                    <div class="sonar-circle delay-1"></div>
                    <div class="sonar-circle delay-2"></div>
                </div>
            </div>
        </section>

        <!-- Image Analyzer Section -->
        <section id="analisis" class="analyzer-section">
            <div class="container">
                <div class="section-header">
                    <h2>Analizador de Imágenes Acústicas</h2>
                    <p>Sube tus imágenes de sonar para análisis automático con IA</p>
                </div>

                <div class="analyzer-container glass-card">
                    <div class="upload-area" id="uploadArea" role="button" tabindex="0"
                        title="Haz clic para seleccionar una imagen">
                        <div class="upload-content">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>Arrastra tu imagen aquí</h3>
                            <p>o haz clic para seleccionar</p>
                            <input type="file" id="fileInput" accept="image/*" hidden>
                        </div>
                    </div>

                    <div class="analysis-results" id="analysisResults" style="display: none;">
                        <div class="result-header">
                            <h3>Resultados del Análisis</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width:0%"></div>
                            </div>
                        </div>

                        <div class="results-grid">
                            <div class="result-card">
                                <h4>Especies Detectadas</h4>
                                <div id="speciesCount">0</div>
                            </div>
                            <div class="result-card">
                                <h4>Nivel de Ruido</h4>
                                <div id="noiseLevel">Bajo</div>
                            </div>
                            <div class="result-card">
                                <h4>Calidad del Agua</h4>
                                <div id="waterQuality">Buena</div>
                            </div>
                            <div class="result-card">
                                <h4>Biodiversidad</h4>
                                <div id="biodiversity">Alta</div>
                            </div>
                        </div>

                        <div class="analysis-details">
                            <h4>Detalles del Análisis</h4>
                            <ul id="analysisDetailsList">
                                <li>Procesando imagen...</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>


            <br><br><br>
            <section id="musica" class="music-section">
                <div class="container">
                    <div class="section-header">
                        <h2>Música Ambiente</h2>
                        <p>Sube tu pista para acompañar el análisis (MP3/OGG/WAV)</p>
                    </div>
                    <div class="url-row" style="margin-left:auto">
                        <input id="musicUrlInput" type="url" class="input-field"
                            placeholder="o pega una URL de audio (mp3/ogg/wav)" autocomplete="off">
                        <button id="musicUrlBtn" type="button" class="btn-primary">
                            <i class="fas fa-link"></i> Usar URL
                        </button>
                    </div>


                    <div class="glass-card player">
                        <button id="musicPlay" class="btn" title="Play/Pause">
                            <i class="fas fa-play"></i>
                        </button>

                        <label class="btn-secondary" style="padding:10px 14px; border-radius:10px; cursor:pointer;">
                            <i class="fas fa-music"></i> <span style="margin-left:6px">Elegir pista</span>
                            <input id="musicFile" type="file" accept="audio/*" hidden />
                        </label>

                        <div class="track">
                            <strong>Pista:</strong> <span id="musicName">ninguna</span>
                        </div>

                        <label>Volumen
                            <input id="musicVolume" type="range" min="0" max="1" step="0.01" value="0.5" />
                        </label>

                        <label style="display:flex; align-items:center; gap:6px">
                            <input id="musicLoop" type="checkbox" />
                            Repetir
                        </label>

                        <audio id="bgMusic" preload="none"></audio>
                    </div>
                </div>
            </section>
            <br><br><br><br>

            <!-- Canvas oculto de trabajo para procesamiento local -->
            <canvas id="workCanvas" width="512" height="512" style="display:none"></canvas>
        </section>

        <!-- Configuration Section -->
        <section id="configuracion" class="config-section">
            <div class="container">
                <div class="section-header">
                    <h2>Configuración Inicial</h2>
                    <p>Personaliza los parámetros de análisis según tu proyecto</p>
                </div>

                <div class="config-grid">
                    <div class="config-card glass-card">
                        <div class="config-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <h3>Parámetros de Frecuencia</h3>
                        <p>Configura rangos de frecuencia específicos para diferentes especies marinas</p>
                        <div class="config-controls">
                            <label for="freqMin">Frecuencia Mínima (Hz)</label>
                            <input id="freqMin" type="range" min="20" max="2000" value="100" class="slider">
                            <label for="freqMax">Frecuencia Máxima (Hz)</label>
                            <input id="freqMax" type="range" min="2000" max="20000" value="10000" class="slider">
                        </div>
                    </div>

                    <div class="config-card glass-card">
                        <div class="config-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3>Ubicación Geográfica</h3>
                        <p>Define la zona de estudio para análisis contextual</p>
                        <div class="config-controls">
                            <input id="lat" type="text" placeholder="Latitud" class="input-field">
                            <input id="lng" type="text" placeholder="Longitud" class="input-field">
                            <select id="ocean" class="select-field">
                                <option>Océano Atlántico</option>
                                <option>Océano Pacífico</option>
                                <option>Mar Mediterráneo</option>
                                <option>Mar Caribe</option>
                            </select>
                        </div>
                    </div>

                    <div class="config-card glass-card">
                        <div class="config-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3>Duración del Monitoreo</h3>
                        <p>Establece períodos de grabación y análisis automático</p>
                        <div class="config-controls">
                            <label for="sessionDuration">Duración por sesión</label>
                            <select id="sessionDuration" class="select-field">
                                <option>15 minutos</option>
                                <option>30 minutos</option>
                                <option>1 hora</option>
                                <option>2 horas</option>
                            </select>
                            <label for="sessionInterval">Intervalo entre sesiones</label>
                            <select id="sessionInterval" class="select-field">
                                <option>1 hora</option>
                                <option>6 horas</option>
                                <option>12 horas</option>
                                <option>24 horas</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Monitoring Section -->
        <section id="monitoreo" class="monitoring-section">
            <div class="container">
                <div class="section-header">
                    <h2>Monitoreo en Tiempo Real</h2>
                    <p>Visualiza datos acústicos en vivo y recibe alertas automáticas</p>
                </div>

                <div class="monitoring-dashboard">
                    <div class="dashboard-stats">
                        <div class="stat-card glass-card">
                            <div class="stat-icon"><i class="fas fa-fish"></i></div>
                            <div class="stat-content">
                                <h3>Especies Activas</h3>
                                <div class="stat-number" id="activeSpecies">12</div>
                                <div class="stat-change positive">+3 desde ayer</div>
                            </div>
                        </div>

                        <div class="stat-card glass-card">
                            <div class="stat-icon"><i class="fas fa-volume-up"></i></div>
                            <div class="stat-content">
                                <h3>Nivel de Ruido</h3>
                                <div class="stat-number" id="noiseDb">45 dB</div>
                                <div class="stat-change negative">-2 dB desde ayer</div>
                            </div>
                        </div>

                        <div class="stat-card glass-card">
                            <div class="stat-icon"><i class="fas fa-thermometer-half"></i></div>
                            <div class="stat-content">
                                <h3>Temperatura</h3>
                                <div class="stat-number" id="temperature">18.5°C</div>
                                <div class="stat-change neutral">Sin cambios</div>
                            </div>
                        </div>

                        <div class="stat-card glass-card">
                            <div class="stat-icon"><i class="fas fa-tint"></i></div>
                            <div class="stat-content">
                                <h3>Salinidad</h3>
                                <div class="stat-number" id="salinity">35.2 PSU</div>
                                <div class="stat-change positive">+0.1 PSU</div>
                            </div>
                        </div>
                    </div>

                    <div class="monitoring-charts">
                        <div class="chart-container glass-card">
                            <h3>Actividad Acústica (24h)</h3>
                            <canvas id="acousticChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-container glass-card">
                            <h3>Distribución de Especies</h3>
                            <canvas id="speciesChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="alerts-panel glass-card">
                        <h3>Alertas Recientes</h3>
                        <div class="alerts-list" id="alertsList">
                            <div class="alert-item warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div class="alert-content">
                                    <h4>Aumento de ruido detectado</h4>
                                    <p>Nivel de ruido superior a 50 dB en zona protegida</p>
                                    <span class="alert-time">Hace 15 minutos</span>
                                </div>
                            </div>
                            <div class="alert-item info">
                                <i class="fas fa-info-circle"></i>
                                <div class="alert-content">
                                    <h4>Nueva especie identificada</h4>
                                    <p>Delfín nariz de botella detectado en sector B</p>
                                    <span class="alert-time">Hace 1 hora</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section class="analysis-section">
            <div class="container">
                <div class="section-header">
                    <h2>Análisis Comparativo</h2>
                    <p>Compara datos históricos y genera informes detallados</p>
                </div>

                <div class="analysis-tools">
                    <div class="tool-card glass-card">
                        <div class="tool-icon"><i class="fas fa-chart-bar"></i></div>
                        <h3>Análisis Temporal</h3>
                        <p>Compara patrones acústicos a lo largo del tiempo</p>
                        <button class="btn-tool">Generar Análisis</button>
                    </div>

                    <div class="tool-card glass-card">
                        <div class="tool-icon"><i class="fas fa-layer-group"></i></div>
                        <h3>Análisis por Capas</h3>
                        <p>Examina diferentes profundidades del océano</p>
                        <button class="btn-tool">Iniciar Análisis</button>
                    </div>

                    <div class="tool-card glass-card">
                        <div class="tool-icon"><i class="fas fa-brain"></i></div>
                        <h3>IA Predictiva</h3>
                        <p>Predicciones basadas en patrones históricos</p>
                        <button class="btn-tool">Ver Predicciones</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Export Section -->
        <section class="export-section">
            <div class="container">
                <div class="section-header">
                    <h2>Exportación de Resultados</h2>
                    <p>Genera informes profesionales en múltiples formatos</p>
                </div>

                <div class="export-options">
                    <div class="export-card glass-card">
                        <div class="export-icon"><i class="fas fa-file-pdf"></i></div>
                        <h3>Informe PDF</h3>
                        <p>Documento completo con gráficos y análisis</p>
                        <button class="btn-export">Descargar PDF</button>
                    </div>

                    <div class="export-card glass-card">
                        <div class="export-icon"><i class="fas fa-file-excel"></i></div>
                        <h3>Datos Excel</h3>
                        <p>Datos en bruto para análisis personalizado</p>
                        <button class="btn-export">Exportar Excel</button>
                    </div>

                    <div class="export-card glass-card">
                        <div class="export-icon"><i class="fas fa-database"></i></div>
                        <h3>Base de Datos</h3>
                        <p>Exportación directa a sistemas externos</p>
                        <button class="btn-export">Configurar API</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="beneficios" class="benefits-section">
            <div class="container">
                <div class="section-header">
                    <h2>Beneficios de ECOSONAR</h2>
                    <p>Descubre cómo nuestra tecnología revoluciona la investigación marina</p>
                </div>

                <div class="benefits-grid">
                    <div class="benefit-card glass-card">
                        <div class="benefit-icon"><i class="fas fa-shield-alt"></i></div>
                        <h3>Conservación Marina</h3>
                        <p>Protege ecosistemas vulnerables mediante monitoreo continuo y alertas tempranas</p>
                    </div>

                    <div class="benefit-card glass-card">
                        <div class="benefit-icon"><i class="fas fa-microscope"></i></div>
                        <h3>Investigación Avanzada</h3>
                        <p>Acelera descubrimientos científicos con análisis automatizado de datos acústicos</p>
                    </div>

                    <div class="benefit-card glass-card">
                        <div class="benefit-icon"><i class="fas fa-coins"></i></div>
                        <h3>Reducción de Costos</h3>
                        <p>Minimiza gastos operativos con monitoreo remoto y análisis automatizado</p>
                    </div>

                    <div class="benefit-card glass-card">
                        <div class="benefit-icon"><i class="fas fa-clock"></i></div>
                        <h3>Tiempo Real</h3>
                        <p>Obtén resultados instantáneos y toma decisiones informadas al momento</p>
                    </div>
                </div>

                <div class="stats-showcase">
                    <div class="stat-showcase">
                        <div class="stat-number">95%</div>
                        <div class="stat-label">Precisión en detección</div>
                    </div>
                    <div class="stat-showcase">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Monitoreo continuo</div>
                    </div>
                    <div class="stat-showcase">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Especies identificables</div>
                    </div>
                    <div class="stat-showcase">
                        <div class="stat-number">80%</div>
                        <div class="stat-label">Reducción de costos</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <i class="fas fa-wave-square"></i>
                        <span>ECOSONAR</span>
                    </div>
                    <p>Revolucionando el análisis acústico marino con tecnología de vanguardia para la conservación de
                        nuestros océanos.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Productos</h3>
                    <ul>
                        <li><a href="#analisis">Análisis de Imágenes</a></li>
                        <li><a href="#monitoreo">Monitoreo en Tiempo Real</a></li>
                        <li><a href="#configuracion">Configuración Avanzada</a></li>
                        <li><a href="#">API de Integración</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Recursos</h3>
                    <ul>
                        <li><a href="#">Documentación</a></li>
                        <li><a href="#">Tutoriales</a></li>
                        <li><a href="#">Casos de Estudio</a></li>
                        <li><a href="#">Soporte Técnico</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Contacto</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-envelope"></i> info@ecosonar.com</p>
                        <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                        <p><i class="fas fa-map-marker-alt"></i> Miami, FL 33101</p>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 ECOSONAR. Todos los derechos reservados.</p>
                <div class="footer-links">
                    <a href="#">Política de Privacidad</a>
                    <a href="#">Términos de Servicio</a>
                    <a href="#">Cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Input oculto para análisis comparativo (capas / temporal) -->
    <input id="compareInput" type="file" accept="image/*" multiple hidden>

    <!-- Sonidito (sintetizado por Web Audio; sin archivos externos) -->
    <script>
        window.__ecosonar_beep = (function () {
            let ctx;
            return function beep(duration = 0.2, frequency = 880, volume = 0.2) {
                try {
                    ctx = ctx || new (window.AudioContext || window.webkitAudioContext)();
                    const o = ctx.createOscillator();
                    const g = ctx.createGain();
                    o.type = "sine";
                    o.frequency.value = frequency;
                    g.gain.value = 0;
                    o.connect(g); g.connect(ctx.destination);
                    o.start();
                    // Fade in-out suave
                    const now = ctx.currentTime;
                    g.gain.linearRampToValueAtTime(0.0001, now);
                    g.gain.exponentialRampToValueAtTime(Math.max(0.0002, volume), now + 0.02);
                    g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
                    o.stop(now + duration + 0.02);
                } catch (e) { /* sin audio */ }
            };
        })();
    </script>

    <!-- Scripts originales -->
    <script src="./js/script.js"></script>

    <!-- Scripts funcionales (añadidos) -->
    <script src="./js/state.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/export.js"></script>
    <script src="./js/compare.js"></script>

    <!-- Arranque + ganchos mínimos y sonido en eventos -->
    <script>
        // Scroll helper (por si tu script.js no lo trae)
        function scrollToSection(id) {
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Click en el área de carga abre el file input
        (function bindUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            if (!uploadArea || !fileInput) return;
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); }
            });
            // soporta drag&drop suave
            ['dragover', 'dragenter'].forEach(ev => uploadArea.addEventListener(ev, e => { e.preventDefault(); uploadArea.classList.add('dragging'); }));
            ['dragleave', 'drop'].forEach(ev => uploadArea.addEventListener(ev, e => { e.preventDefault(); uploadArea.classList.remove('dragging'); }));
        })();

        // Sonidito: nuevas alertas en la lista -> beep
        (function soundOnAlerts() {
            const list = document.getElementById('alertsList');
            if (!list || !window.__ecosonar_beep) return;
            const mo = new MutationObserver(muts => {
                for (const m of muts) {
                    if (m.addedNodes && m.addedNodes.length) {
                        window.__ecosonar_beep(0.18, 880, 0.2);
                    }
                }
            });
            mo.observe(list, { childList: true });
        })();

        // Sonidito: cuando los resultados de análisis se muestran por primera vez
        (function soundOnAnalysisShown() {
            const panel = document.getElementById('analysisResults');
            if (!panel || !window.__ecosonar_beep) return;
            let visible = panel.style.display !== 'none';
            const mo = new MutationObserver(() => {
                const nowVisible = panel.style.display !== 'none';
                if (nowVisible && !visible) {
                    window.__ecosonar_beep(0.22, 740, 0.18);
                }
                visible = nowVisible;
            });
            mo.observe(panel, { attributes: true, attributeFilter: ['style'] });
        })();

        // Inicializa ecosonar (persistencia + IA + export + comparativos + stream)
        window.addEventListener('DOMContentLoaded', () => {
            if (window.ECOSONAR && typeof window.ECOSONAR.init === 'function') {
                window.ECOSONAR.init();
            }
        });
    </script>
</body>

</html>